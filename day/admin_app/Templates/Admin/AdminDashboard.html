{% extends "base/base.html" %}
{% load static %}
{% block title %}Dashboard {% endblock title %}



  {% block bodyblock %}
  <!-- Main Content -->
  <main id="main" class="main">
    <div class="pagetitle">
      <h1>Main Dashboard </h1>

      <a href="{% url 'Admin_Signup' %}"> <button type="submit"  class="btn btn-primary"><i class="bi bi-person-plus-fill"></i>&nbsp; Add Ec Member</button></a>
    </div>
      
    </div>

      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="">Home</a></li>
          <li class="breadcrumb-item active">Dashboard</li>
          
        </ol>
      </nav>
  <!-- End Page Title -->

   
    <!-- Dashboard Stats Section -->
    <section class="section dashboard">
      <div class="row">

        <!-- Left side columns -->
        <div class="col-lg-12">
          <div class="row">

            <!-- Stats Cards -->
            <div class="col-xxl-3 col-xl-12 col-sm-12 mb-4">
              <div class="card info-card sales-card">
                <div class="card-body">
                  <h5 class="card-title">Total Events</h5>
                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-list-ol"></i>
                    </div>
                    <div class="ps-3">
                      <h6 class="counts">{{ total_event }}</h6>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Impact Card -->
            <div class="col-xxl-3 col-xl-12 col-sm-12 mb-4">
              <div class="card info-card customers-card">
                <div class="card-body">
                  <h5 class="card-title">Total Impact</h5>
                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-people"></i>
                    </div>
                    <div class="ps-3">
                      <h6 class="count">{{ total_impact|floatformat:"g" }}</h6>
                    </div>
                  </div>
                </div> 
              </div>
            </div>

            <!-- Expense Card -->
            <div class="col-xxl-3 col-xl-12 col-sm-12 mb-4">
              <div class="card info-card customers-card">
                <div class="card-body">
                  <h5 class="card-title">Total Expense</h5>
                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-currency-rupee"></i>
                    </div>
                    <div class="ps-3">
                      <h6 class="count">{{ total_expense|floatformat:"g"  }}</h6>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            {% comment %} <div class="col-xxl-4 col-xl-12 col-sm-12 mb-4">
              <div class="card info-card customers-card">
                <div class="card-body">
                  <h5 class="card-title">Total Impact</h5>
                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-people"></i>
                    </div>
                    <div class="ps-3">
                      <h6 class="count">{{ total_impact|floatformat:"g" }}</h6>
                    </div>
                  </div>
                </div> 
              </div>
            </div> {% endcomment %}

            <!-- Manager Card -->
      <div class="col-xxl-3 col-xl-12 col-sm-12 mb-4">
              <div class="card info-card sales-card">
                <div class="card-body">
                  <h5 class="card-title">Total EC Members </h5>
                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-person"></i>
                    </div>
                    <div class="ps-3">
                      <h6 class="count">{{ total_manager }}</h6>
                    </div>
                  </div>
                </div>
              </div>
            </div> 

          </div>
          
        </div><!-- End Left side columns -->
      
      </div>
   
      <div>
        <button type="submit"  onclick="table()"  class="btn btn-primary"><i class="bi bi-table"></i>&nbsp; Show a Table</button>
        <button type="submit" onclick="chart()"  class="btn btn-primary"><i class="bi bi-bar-chart-line-fill"></i>&nbsp; Show a Chart</button>
      </div><br>

      <div class="card" id="table">
        <div class="card-header d-flex justify-content-between align-items-center">
          <div class="event-title-icon rounded-circle bg-primary ">
            <i class="bi bi-calendar-check text-primary fs-4"></i>
          </div>
          {% comment %} <img src="{% static 'Image/YIIMG.png' %}" alt="logo img" width="90px" height="90px;" class="rounded-circle" > {% endcomment %}
          <h1 style="color: #012970;">Yi Ahmedabad Event's</h1>
            {% comment %} <h5 class="card-title mb-0">Yi Events </h5> {% endcomment %}
            <div class="d-flex align-items-center">
           
                <form method="get" action="{% url 'Admin_Dashboard' %}" id="managerFilterForm" class="me-2">
                    <select class="form-select form-select-sm" id="search" name="search" onchange="this.form.submit()">
                        <option value="" disabled selected>Choose by Name</option>
                        <option value="all">All</option>
                        {% for i in m1 %}
                            <option value="{{ i }}">{{ i }}</option>
                        {% endfor %}
                    </select>
                </form>

                <!-- Download Excel Button -->
            
                <a href="{% url 'download_excel' %}" ><button type="submit"   class="btn btn-success"> <i class="bi bi-file-earmark-excel-fill"></i> &nbsp; Export</button></a>
            </div>
        </div>

        <div class="card-body">
            <div class="table-responsive">
                <table class="table  table-hover" id="eventTable">
                    <thead class="table-light">
                        <tr class="text-nowrap text-center">
                            <th>Sr.no</th>
                            <th>Event Date</th>
                            <th>Member Name</th>
                            <th>Event Name</th>
                            <th>Event Venue</th>
                            <th>Event Expense</th>
                            <th>Role In YI</th>
                            <th>EC Members name</th>
                            <th>Project Vertical</th>
                            <th>School</th>
                            <th>Collage</th>
                            <th>Associate Partner</th>
                            <th>S.I.G</th>
                            <th>Event Impact</th>
                            <th>Event Image</th>
                            
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="display">
                        {% if events %}
                            {% for event in events %}
                                <tr  class="text-nowrap text-center" data-bs-toggle="modal" data-bs-target="#editEventModal{{ event.id }}">
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ event.date }}</td>
                                    <td>{{ event.your_name }}</td>
                                    <td>{{ event.event_name }}</td>
                                    <td>{{ event.event_venue }}</td>
                                    <td>â‚¹ {{ event.event_expense|floatformat:"2" }}</td>
                                    <td>{{ event.role_yi }}</td>
                                    <td>{{ event.event_handle }}</td>
                                    <td>{{ event.project_vertical }}</td>
                                    <td>{{ event.school }}</td>
                                    <td>{{ event.collage }}</td>
                                    <td>{{ event.associate_partner }}</td>
                                    <td>{{ event.which_SIG }}</td>
                                    <td>{{ event.total_impact|floatformat:"g" }}</td>
                                    <td>
                                      {% if event.event_photo.all %}
                                          {% with first_image=event.event_photo.first %}
                                              <img src="{{ first_image.event_photo.url }}" alt="Event Image" height="39" width="50" class="event-thumbnail"
                                                   data-bs-toggle="modal" data-bs-target="#imageModal{{ event.id }}"
                                                   data-image-url="{{ first_image.event_photo.url }}" >
                                          {% endwith %}
                                      {% else %}
                                          <p>No image uploaded for this event. </p>
                                      {% endif %}
                                  </td>
                                  
                                  <!-- Modal to display and delete images -->
                                                              <div class="modal fade" id="imageModal{{ event.id }}" tabindex="-1" aria-labelledby="imageModalLabel{{ event.id }}" aria-hidden="true">
                                                                  <div class="modal-dialog modal-lg">
                                                                      <div class="modal-content">
                                                                          <div class="modal-header">
                                                                              <h5 class="modal-title" id="imageModalLabel{{ event.id }}">Event Images</h5>
                                                                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                          </div>
                                                                          <div class="modal-body">
                                                                              <div id="imageGallery{{ event.id }}" class="carousel slide carousel-fade" data-bs-ride="carousel">
                                                                                  <div class="carousel-inner">
                                                                                      {% for image in event.event_photo.all %}
                                                                                          <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                                                                              <img src="{{ image.event_photo.url }}" class="d-block w-100" width="500px" height="500px" alt="Event Image"><br>
                                  
                                                                                              <!-- Form for deleting the image -->
                                                                                            
                                                                                              <form method="POST" action="{% url 'event_image_id' image_id=image.id %}">
                                                                                                  {% csrf_token %}
                                                                                                  <button type="submit" class="btn btn-danger yi-btn">Delete Image</button>
                                                                                              </form>
                                                                                        
                                                                                          </div>
                                                                                      {% endfor %}
                                                                                  </div>
                                                                                  <button class="carousel-control-prev yi-navigation" type="button" data-bs-target="#imageGallery{{ event.id }}" data-bs-slide="prev">
                                                                                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                                                      <span class="visually-hidden">Previous</span>
                                                                                  </button>
                                                                                  <button class="carousel-control-next yi-navigation" type="button" data-bs-target="#imageGallery{{ event.id }}" data-bs-slide="next">
                                                                                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                                                      <span class="visually-hidden">Next</span>
                                                                                  </button>
                                                                              </div>
                                                                          </div>
                                                                      </div>
                                                                  </div>
                                                              </div>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <!-- View Button -->
                                            {% comment %} <button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#viewEventModal{{ event.id }}">
                                                <i class="bi bi-eye"></i>
                                            </button> {% endcomment %}
                                            
                                            <!-- Edit Button -->
                                            <button type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editEventModal{{ event.id }}">
                                              <i class="bi bi-pencil-square"></i>
                                            </button>
                                            &nbsp;
                                            <!-- Delete Button -->
                                            <form method="post" action="{% url 'delete_event' event_id=event.id %}" class="d-inline">
                                                {% csrf_token %}
                                                <button class="btn btn-danger btn-sm">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                  <!-- Edit Event Modal -->
                  <div class="modal fade" id="editEventModal{{ event.id }}" tabindex="-1" aria-labelledby="editEventModalLabel{{ event.id }}" aria-hidden="true">
                    <div class="modal-dialog ">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editEventModalLabel{{ event.id }}">Edit Event</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form method="post" action="{% url 'Update_event_data' event_id=event.id %}"  enctype="multipart/form-data">
                                    {% csrf_token %}

                                    <div class="mb-3">
                                        <label for="event_date" class="form-label">Event Date</label>
                                        <input type="date" class="form-control" id="event_date" name="event_date" value="{{ event.date }}">
                                    </div>

                                    <div class="mb-3">
                                        <label for="event_name" class="form-label">Event Name</label>
                                        <input type="text" class="form-control" id="event_name" name="event_name" value="{{ event.event_name }}">
                                    </div>

                                    <div class="mb-3">
                                        <label for="event_handle" class="form-label">Members Name</label>
                                        <input type="text" class="form-control" id="event_handle" name="event_handle" value="{{ event.event_handle }}">
                                    </div>

                                    <div class="mb-3">
                                        <label for="role_yi" class="form-label">YI Role</label>
                                        <select class="form-control" id="role_yi" name="role_yi">
                                            <option value="{{ event.role_yi }}">{{ event.role_yi }}</option>
                                            <option value="Vertical Chair">Vertical Chair</option>
                                            <option value="Vertical Co-Chair">Vertical Co-Chair</option>
                                            <option value="Team Member">Team Member</option>
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label for="project_verticals" class="form-label">Project Verticals</label>
                                        <select class="form-control" id="project_verticals" name="project_verticals">
                                            <option value="{{ event.project_vertical }}">{{ event.project_vertical }}</option>
                                            <!-- Add all vertical options -->
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label for="project_stakeholder" class="form-label">Project Stakeholder</label>
                                        <select class="form-control" id="project_stakeholder" name="project_stakeholder">
                                            <option value="{{ event.project_stakeholder }}">{{ event.project_stakeholder }}</option>
                                            <!-- Add all stakeholder options -->
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label for="yi_pillar" class="form-label">Yi Pillar</label>
                                        <select class="form-control" id="yi_pillar" name="yi_pillar">
                                            <option value="{{ event.yi_pillar }}">{{ event.yi_pillar }}</option>
                                            <!-- Add all pillar options -->
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label for="social_link" class="form-label">Social Link</label>
                                        <input type="url" class="form-control" id="social_link" name="social_link" value="{{ event.social_link }}">
                                    </div>

                                    <div class="mb-3">
                                        <label for="total_impact" class="form-label">Impact</label>
                                        <input type="text" class="form-control" id="total_impact" name="total_impact" value="{{ event.total_impact }}">
                                    </div>

                                    <div class="mb-3">
                                        <label for="event_expense" class="form-label">Event Expense</label>
                                        <input type="number" class="form-control" id="event_expense" name="event_expense" value="{{ event.event_expense }}">
                                    </div>

                                    <div class="mb-3" id="sig_div">
                                        <label for="sig_">Choose SIG</label>
                                        <select class="form-control" id="sig_" name="sig_">
                                            <option value="{{ event.which_SIG }}">{{ event.which_SIG }}</option>
                                            <!-- Add SIG options -->
                                        </select>
                                    </div>

                                    <div class="mb-3" id="associate_div">
                                        <label for="associate_partners">Associate Partner</label>
                                        <select class="form-control" id="associate_partners" name="associate_partners">
                                            <option value="{{ event.associate_partner }}">{{ event.associate_partner }}</option>
                                            <!-- Add associate partners -->
                                        </select>
                                    </div>

                                    <div class="mb-3" id="school_div">
                                        <label for="school">School</label>
                                        <input type="text" id="school" class="form-control" name="school" placeholder="School" value="{{ event.school }}">
                                    </div>

                                    <div class="mb-3" id="collage_div">
                                        <label for="collage">College</label>
                                        <input type="text" id="collage" class="form-control" name="collage" placeholder="College" value="{{ event.collage }}">
                                    </div>
                                    

                                    <div class="mb-3" id="collage_div">
                                      <label for="event_image">Event Image</label>
                                      <input type="file" id="event_image" class="form-control" name="event_image" multiple>
                                  </div>
                                    
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button type="submit" class="btn btn-primary">Save changes</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
            {% else %}
            <tr>
              <td colspan="17" class="text-center"> No Event available </td>
            </tr>
            {% endif %}
        </tbody>
    </table>

                <!-- Pagination -->
                <nav aria-label="Event table navigation">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        {% comment %} <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link" href="#">4</a></li>
                        <li class="page-item"><a class="page-link" href="#">5</a></li> {% endcomment %}
                        <li class="page-item">
                            <a class="page-link" href="#">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>


    <div id="chart" >
      <iframe width="1700" height="1050" src="https://lookerstudio.google.com/embed/reporting/56ad84bc-6bf3-448f-900c-e7152ce74a03/page/HFnbE" frameborder="0" style="border:0" allowfullscreen sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"></iframe>
    </div>



    </section>

    

  </main><!-- End #main -->
  {% endblock bodyblock %} 
  
  {% block script %}
  <script src="{% static 'js/dashboard.js' %}"></script>
  {% comment %} <script>
    $(document).ready(function() {
      setInterval(function() {
        $.ajax({
          type: 'GET',
          url: "{% url 'getuser' %}",  
          success: function(response) {
            console.log("Data Added");
          },
          error: function(response) {
            alert("No Data Found");
          }
        });
      }, 1000); 
    });
  </script> {% endcomment %}
  


  <script>$('.counts').each(function () {
    $(this).prop('Counter',0).animate({
        Counter: $(this).text()
    }, {
        duration: 3000,
        easing: 'swing',
        step: function (now) {
            $(this).text(Math.ceil(now));
        }
    });
});</script>
  {% endblock script %}




  

