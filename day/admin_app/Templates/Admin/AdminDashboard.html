
{% extends "base/base.html" %}
{% load static %}
{% load humanize %}
{% block title %}Dashboard {% endblock title %}

{% block bodyblock %}

{% block static %}
<style>

.form-label{
  font-weight:bold;


}

</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>


{% endblock static %}
<!-- Main Content -->
<main id="main" class="main">
  <div class="pagetitle d-flex justify-content-between align-items-center">
    <h1>Dashboard</h1>
    {% comment %} <a href="{% url 'Admin_Signup' %}"> <button type="submit"  class="btn btn-primary"><i class="bi bi-person-plus-fill"></i>&nbsp; Add EC Member</button></a></div> {% endcomment %}
  </div>

  </div>
    {% comment %} <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'Admin_Dashboard' %}">Home</a></li>
        <li class="breadcrumb-item active">Admin</li>
      </ol>
    </nav> {% endcomment %}

<!-- Button trigger modal -->
<!-- Button trigger modal -->


<!-- Modal -->

    

  <!-- Dashboard Stats Section -->
  <section class="section dashboard">
   
    <!-- Stats Cards -->
    <div class="row mb-4">
      <!-- Total Events Card -->
      <div class="col-lg-2 col-md-6 col-sm-12 mb-4">
        <div class="card info-card shadow-sm border-0">
          <div class="filter">
            <a class="icon" href="#" data-bs-toggle="dropdown">
              <i class="bi bi-three-dots"></i>
            </a>
            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
              <li class="dropdown-header text-start">
                <h6>Vertical</h6>
              </li>
      
              <!-- Show "All" option by default -->
              <li><a class="dropdown-item" href="?vertical=all">All Verticals</a></li>
      
              <!-- Loop through verticals -->
              {% for i in verticals %}
              <li><a class="dropdown-item" href="?vertical={{ i }}">{{ i }}</a></li>
              {% endfor %}
            </ul>
          </div>
      
          <div class="card-body">
            <h5 class="card-title">
              <i class="bi bi-list-check text-primary"></i>&nbsp; Vertical
            </h5>
            <div class="d-flex align-items-center">
              <div class="ps-3">
                <h6>{{ total_vertical }}</h6>
              </div>
            </div>
          </div>
        </div>
      </div>

  
      <!-- Total Events Card -->
      <div class="col-lg-2 col-md-6 col-sm-12 mb-4">
        <div class="card info-card shadow-sm border-0">
          <div class="card-body">
            <h5 class="card-title"><i class="bi bi-list-ol text-primary"></i>&nbsp; Total Events</h5>
            <div class="d-flex align-items-center">
              {% comment %} <div class="card-icon rounded-circle d-flex align-items-center justify-content-center bg-primary-light">
                <i class="bi bi-list-ol text-primary"></i>
              </div> {% endcomment %}
              <div class="ps-3">
                <h6>  {{total_event}}</h6>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Impact Card -->
      <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
        <div class="card info-card shadow-sm border-0">
          <div class="card-body">
            
            <h5 class="card-title"><i class="bi bi-people text-success"></i>&nbsp; Total Impact</h5>
            <div class="d-flex align-items-center">
              {% comment %} <div class="card-icon rounded-circle d-flex align-items-center justify-content-center bg-success-light">
                <i class="bi bi-people text-success"></i>
              </div> {% endcomment %}
              <div class="ps-3">
                <h6>{{ total_impact}}</h6>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Expense Card -->
      <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
        <div class="card info-card shadow-sm border-0">
          <div class="card-body">
            <h5 class="card-title"><i class="bi bi-currency-rupee"></i> &nbsp;Total Expense</h5>
            <div class="d-flex align-items-center">
            
              <div class="ps-3">
                <h6>{{ total_expense|intcomma }}</h6>
              </div>
            </div>
          </div>
        </div>
      </div>
      
                <div class="row mb-3">
                  <div class="col-12 d-flex justify-content-center">
                      <div class="btn-group" role="group">
                          <button type="button" id="tableViewBtn" class="btn btn-outline-primary">
                              <i class="bi bi-table me-2"></i>Yi Table
                          </button>
                          <button type="button" id="chartViewBtn" class="btn btn-outline-primary">
                              <i class="bi bi-graph-up me-2"></i>Yi Analytics
                          </button>
                      </div>
                  </div>
              </div>

              
            <div id="tableView">
                <!-- View Toggle Buttons -->
                <div class="card-header bg-white py-3">
                  <div class="card-header bg-white d-flex flex-wrap justify-content-between align-items-center py-3">
                      <h1 style="color:darkblue">Yi Ahmedabad Events</h1>
              
                       <div class="d-flex gap-2">
                        <div class="d-flex">
                                  <a href="{% url 'Admin_Dashboard' %}" class="btn btn-secondary">
                                    <i class="bi bi-arrow-clockwise"></i>
                                  </a>&nbsp;&nbsp;
                                  <a href="{% url 'download_excel' %}" class="btn btn-success">
                                    <i class="bi bi-download"></i>
                                </a> &nbsp;&nbsp;
                                {% comment %} <a href="#" class="btn btn-outline-dark">
                                  {{event_count}}
                              </a>  {% endcomment %}
                                </div>
                      </div> 
                  </div>
              
                  <div class="col-12">
                      <div class="row g-2">
                          <form method="get" action="{% url 'Admin_Dashboard' %}" id="managerFilterForm" class="d-flex flex-wrap">
                            <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                              <div class="d-flex">
                                  {% comment %} <select class="form-select me-2" id="event_date" name="event_date" onchange="this.form.submit()">
                                      <option value="" disabled selected>Event Date</option>
                                      <option value="all">All</option>
                                      {% for i in event_date %}
                                          <option value="{{ i }}"{% if i == request.GET.event_date %} selected {% endif %}>{{ i }}</option>
                                      {% endfor %}
                                  </select> {% endcomment %}
                              </div>
                          </div>
              
                              <!-- Date Range Search -->
                              <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                                  <div class="d-flex">
                                      {% comment %} <select class="form-select me-2" id="stakeholder" name="stakeholder" onchange="this.form.submit()">
                                          <option value="" disabled selected>Stakeholder</option>
                                          <option value="all">All</option>
                                          {% for i in stakeholder %}
                                              <option value="{{ i }}"{% if i == request.GET.stakeholder %} selected {% endif %}>{{ i }}</option>
                                          {% endfor %}
                                      </select> {% endcomment %}
                                  </div>
                              </div>
              
                              <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                                  <div class="d-flex">
                                      {% comment %} <select class="form-select me-2" id="ec_name" name="ec_name" onchange="this.form.submit()">
                                          <option value="" disabled selected>EC Member Name</option>
                                          <option value="all">All</option>
                                          {% for i in member_name %}
                                              <option value="{{ i }}"{% if i == request.GET.ec_name %} selected {% endif %}>{{ i }}</option>
                                          {% endfor %}
                                      </select> {% endcomment %}
                                  </div>
                              </div>
              
                              <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                                  <div class="d-flex">
                                      {% comment %} <select class="form-select me-2" id="yi_role" name="yi_role" onchange="this.form.submit()">
                                          <option value="" disabled selected>Yi Role</option>
                                          <option value="all">All</option>
                                          {% for i in yi_role %}
                                              <option value="{{ i }}"{% if i == request.GET.yi_role %} selected {% endif %}>{{ i }}</option>
                                          {% endfor %}
                                      </select> {% endcomment %}
                                  </div>
                              </div>
              
                              <!-- Event Name Search -->
                              <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                                  <div class="d-flex">
                                      {% comment %} <select class="form-select me-2" id="yi_pillar" name="yi_pillar" onchange="this.form.submit()">
                                          <option value="" disabled selected>Yi Pillar</option>
                                          <option value="all">All</option>
                                          {% for i in yi_pillar %}
                                              <option value="{{ i }}"{% if i == request.GET.yi_pillar %} selected {% endif %}>{{ i }}</option>
                                          {% endfor %}
                                      </select> {% endcomment %}
                                  </div>
                              </div>
              
                              <!-- Vertical Search Dropdown -->
                              <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                                  <div class="d-flex">
                                      {% comment %} <select class="form-select me-2" id="verticals" name="verticals" onchange="this.form.submit()">
                                          <option value="" disabled selected>Yi Verticals</option>
                                          <option value="all">All</option>
                                          {% for i in verticals %}
                                              <option value="{{ i }}"{% if i == request.GET.verticals %} selected {% endif %}>{{ i }}</option>
                                          {% endfor %}
                                      </select> {% endcomment %}
                                  </div>
                              </div>
                              <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                                
                              </div>
                          </form>
                      </div>
                  </div>
              </div>
              
                        <div class="card-body">
                          {% comment %} <form method="post" action="{% url 'delete_multiple_events' %}"> {% endcomment %}
                          <div class="table-responsive">
                        
                            <table class="table table-hover bordered align-middle"  id="eventTable">
                              <thead class="table-light"  style="overflow-y:auto;">
                                <tr class="text-center text-nowrap">
                                  {% comment %} <th>Select </th> {% endcomment %}
                                  {% comment %} <th>Select</th> {% endcomment %}
                                  <th>Sr No</th>
                                  <th>Date</th>
                                  <th>Member Name</th>
                                  <th>Event Name</th>
                                  <th>Yi Verticals</th>
                                  <th>Stakeholder</th>
                                  <th>Venue</th>
                                  <th>Expense</th>
                                  <th>EC Members Name</th>
                                  <th>Event Members Name</th>
                                  <th>Designation</th>
                                  <th>Yi Pillar</th>
                                  <th>School</th>
                                  <th>College</th>
                                  <th>S.I.G</th>
                                  <th>Impact</th>
                                  <th>Event Description</th>
                                  <th>Social Link</th>
                                  <th>Image</th>
                                  <th>Actions</th>
                                </tr>

                                
                              </thead>
                              <form method="get" action="{% url 'Admin_Dashboard' %}" id="" class="d-flex flex-wrap">

                                <thead>
                                  
                                  <th></th>
                                  <th>
                                    <select class="form-select  form-select-sm rounded-pill" id="event_date" name="event_date" onchange="this.form.submit()">
                                      <option value="" disabled selected>Date</option>
                                      <option value="all">All</option>
                                      {% for i in event_date %}
                                        <option value="{{ i }}"{% if i == request.GET.event_date %} selected {% endif %}>{{ i }}</option>
                                      {% endfor %}
                                    </select>
                                  </th>
                                  <th><select class="form-select  form-select-sm rounded-pill" id="ec_name" name="ec_name" onchange="this.form.submit()">
                                    <option value="" disabled selected>Member</option>
                                    <option value="all">All</option>
                                    {% for i in member_name %}
                                      <option value="{{ i }}"{% if i == request.GET.ec_name %} selected {% endif %}>{{ i }}</option>
                                    {% endfor %}
                                  </select></th>
                                  <th></th>
                                  <th ><select class="form-select  form-select-sm rounded-pill" id="verticals" name="verticals" onchange="this.form.submit()">
                                    <option value="" disabled selected>Yi Verticals</option>
                                    <option value="all">All</option>
                                    {% for i in verticals %}
                                      <option value="{{ i }}"{% if i == request.GET.verticals %} selected {% endif %}>{{ i }}</option>
                                    {% endfor %}
                                  </select></th>
                                  <th><select class="form-select  form-select-sm rounded-pill" id="stakeholder" name="stakeholder" onchange="this.form.submit()">
                                    <option value="" disabled selected>Stakeholder</option>
                                    <option value="all">All</option>
                                    {% for i in stakeholder %}
                                      <option value="{{ i }}"{% if i == request.GET.stakeholder %} selected {% endif %}>{{ i }}</option>
                                    {% endfor %}
                                  </select></th>
                                  <th></th>
                                  <th></th>
                                  <th></th>
                                
                                  <th></th>
                                  <th><select class="form-select  form-select-sm rounded-pill " id="yi_role" name="yi_role" onchange="this.form.submit()">
                                    <option class="text-nowrap" value="" disabled selected>Designation</option>
                                    <option value="all">All</option>
                                    {% for i in yi_role %}
                                      <option value="{{ i }}"{% if i == request.GET.yi_role %} selected {% endif %}>{{ i }}</option>
                                    {% endfor %}
                                  </select></th>
                                  <th>        <select class="form-select  form-select-sm rounded-pill" id="yi_pillar" name="yi_pillar" onchange="this.form.submit()">
                                    <option value="" disabled selected>Yi Pillar</option>
                                    <option value="all">All</option>
                                    {% for i in yi_pillar %}
                                      <option value="{{ i }}"{% if i == request.GET.yi_pillar %} selected {% endif %}>{{ i }}</option>
                                    {% endfor %}
                                  </select></th>
                                  <th></th>
                                  <th></th>
                                  <th></th>
                                  <th></th>
                                  <th></th>
                                  <th></th>
                                  <th></th>
                                  <th></th>
                               
                                </thead>
                              </form>
                              
                              <tbody id="display" >

                                {% if events %}
                                  {% for event in events %}
                                    <tr class="text-center text-nowrap">
                                      {% comment %} <td><input type="checkbox" value={{event.id}} name="event_ids"></td> {% endcomment %}
                                      <td>{{ forloop.counter }}</td>
                                      <td>{{ event.date }}</td>
                                      <td>{{ event.your_name }}</td>
                                      <td class="ellipsis"><span data-toggle="tooltip" data-placement="top" title="{{event.event_name}}">{{ event.event_name }}</span></td>
                                      <td>{{event.project_vertical}}
                                      <td >{{event.project_stakeholder}}
                                      <td>{{ event.event_venue }}</td>
                                      <td>₹ {{ event.event_expense|intcomma }}</td>
                                      {% if event.select_ec_member == '' or event.select_ec_member == None   %}
                                     <td> <span class="badge bg-light text-dark">No Members</span></td>
                                      {% else %}
                                      <td class="event-handle" justify>{{ event.select_ec_member }}</td>
                                      {% endif %}
                                      
                                      {% if event.event_member == '' or event.event_member == None %}
                                      <td> <span class="badge bg-light text-dark">No Members</span></td>
                                      {% else %}
                                      <td class="event-handle" justify>{{ event.event_member }}</td>
                                      {% endif %}
                                    
                                      <td>{{ event.role_yi }}</td>
                                      <td>{{ event.yi_pillar }}</td>
                                      <td> {{ event.school  }}</td>
                                      <td>{{event.collage}}</td>
                                      <td>{{event.which_SIG}}</td>
                              
                                      <td>{{ event.total_impact|floatformat:"g" }}</td>
                                      {% if event.event_description == '' or event.event_description == None  %}
                                      <td> <span class="badge bg-light text-dark">No Description</span> </td>
                  
                                      {% else %}
                                      <td class="ellipsis"><span data-bs-toggle="modal" data-bs-target="#staticBackdrop{{event.id}}" title="{{event.event_description}}">{{ event.event_description }}</td>
                                        
                                      


                                      {% endif %}
                                      
                                        {% if event.social_link == '' %}
                                       
                                        <td><span class="badge bg-light text-dark">No link</span></td>
                                        {% else %}
                                       <td><a href="{{ event.social_link}}" ><i class="bi bi-link"></i></a></td>
                                        {% endif %}
                                      
                                      <td>
                                        {% if event.event_photo.all %}
                                          {% with first_image=event.event_photo.first %}
                                            <img src="{{ first_image.event_photo.url }}" alt="Event Image" class="rounded" height="40" width="60" 
                                                data-bs-toggle="modal" data-bs-target="#imageModal{{ event.id }}"
                                                data-image-url="{{ first_image.event_photo.url }}" style="cursor: pointer;" >
                                          {% endwith %}
                                        {% else %}
                                          <span class="badge bg-light text-dark">No image</span>
                                        {% endif %}
                                      </td>
                                      <td>
                                        <div class="btn-group" role="group">
                                          <button type="button" class="btn btn-sm btn-outline-warning" data-bs-toggle="modal" data-bs-target="#editEventModal{{ event.id }}">
                                            <i class="bi bi-pencil-square"></i>
                                          </button>
                                          <form method="post" action="{% url 'delete_event' event_id=event.id %}" class="d-inline" >
                                            {% csrf_token %}
                                            <button class="btn btn-sm btn-outline-danger ms-1" >
                                              <i class="bi bi-trash"></i>
                                            </button>
                                          </form>
                                        </div>
                                      </td>
                                    </tr>
                                    <!-- Modal -->
                                    
                                    <div class="modal fade" id="staticBackdrop{{event.id}}"  tabindex="-1"  aria-hidden="true">
                                      <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                          <div class="modal-header">
                                            <h1 class="modal-title fs-5" id="staticBackdropLabel">Event Description</h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                          </div>
                                          <div class="modal-body">
                                          {{event.event_description}}
                                          </div>
                                          {% comment %} <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                            <button type="button" class="btn btn-primary">Understood</button>
                                          </div> {% endcomment %}
                                        </div>
                                      </div>
                                    </div>


                                    <!-- Image Modal -->
                                   
                                              <div class="modal fade" id="imageModal{{ event.id }}" tabindex="-1" aria-hidden="true">
                                                <div class="modal-dialog modal-xl">
                                                  <div class="modal-content">
                                                    <div class="modal-header">
                                                      <h5 class="modal-title">Event Images</h5>
                                                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>

                                                    <div class="modal-body">
                                                      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4" style="max-height: 500px; overflow-y: auto;">
                                                        {% for image in event.event_photo.all %}
                                                          <div class="col position-relative">
                                                            <div class="card h-100 shadow">
                                                              <img src="{{ image.event_photo.url }}" class="card-img-top" alt="Event Image" style="object-fit: contain; max-height: 300px;">
                                                              <div class="card-body p-2 text-center">
                                                                <form method="POST" action="{% url 'event_image_id' image_id=image.id %}" onsubmit="event.stopPropagation();">
                                                                  {% csrf_token %}
                                                                  <button type="submit" class="btn btn-danger btn-sm" onclick="event.stopPropagation();">
                                                                    <i class="bi bi-trash-fill"></i> Delete
                                                                  </button>
                                                                </form>
                                                              </div>
                                                            </div>
                                                          </div>
                                                        {% endfor %}
                                                      </div>
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>
                                                                            
                                    <!-- Edit Event Modal -->
                                    <div class="modal fade"  id="editEventModal{{ event.id }}" tabindex="-1" aria-hidden="true">
                                      <div class="modal-dialog modal-lg">
                                        <div class="modal-content">
                                          <div class="modal-header bg-light">
                                            <h5 class="modal-title">Edit Event</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                          </div>
                                          <div class="modal-body">
                                            <form method="post" id="edit_event" action="{% url 'Update_event_data' event_id=event.id %}" enctype="multipart/form-data">
                                              {% csrf_token %}
                                              <div class="row g-3">
                                                <div class="col-md-6">
                                                  <label for="event_date" class="form-label">Event Date </label><span style="color:red;"> *</span>
                                                  <input type="date" class="form-control" id="event_date" name="event_date" value="{{ event.date }}">
                                                  <div class="invalid-feedback" id="event_date_error">Please provide an event date.</div>
                                                </div>
                                                <div class="col-md-6">
                                                  <label for="event_name" class="form-label">Event Name </label><span style="color:red;"> *</span>
                                                  <input type="text" class="form-control" id="event_name" name="event_name" value="{{ event.event_name }}">
                                                  <div class="invalid-feedback" id="event_name_error">Please provide an event name.</div>
                                                </div>
                                                <div class="col-md-6">
                                                  <label for="event_handle" class="form-label">Members Name</label>
                                                  <input type="text" class="form-control" id="event_handle" name="event_handle" value="{{ event.event_member }}">
                                                </div>


                                                <div class="col-md-6">
                                                  <label for="select_ec_member" class="form-label">EC Members Name</label>
                                                  <input type="text" class="form-control" id="select_ec_member" name="select_ec_member" value="{{ event.select_ec_member }}">
                                                </div>

                                                <div class="col-md-6">
                                                  <label for="role_yi" class="form-label">Designation</label><span style="color:red;"> *</span>
                                                  <select class="form-select" id="role_yi" name="role_yi">
                                                    <option value="{{ event.role_yi }}">{{ event.role_yi }}</option>
                                                    <option value="Chair">Chair</option>
                                                    <option value="Co-Chair">Co-Chair</option>
                                                    <option value="Branding">Branding</option>
                                                    <option value="Admin">Admin</option>
                                             
                                                  </select>
                                                  <div class="invalid-feedback" id="event_yi_role_error">Please provide an event Yi Role.</div>
                                                </div>
                                                <div class="col-md-6">
                                                  <label for="project_verticals" class="form-label">Project Verticals </label><span style="color:red;"> *</span>
                                                  <select class="form-select" id="project_verticals" name="project_verticals">
                                                    <option value="{{ event.project_vertical }}">{{ event.project_vertical }}</option>
                                                    <option value="Masoom">Masoom</option>
                                                    <option value="Road Safety">Road Safety</option>
                                                    <option value="Health">Health</option>
                                                    <option value="Sport">Sports</option>
                                                    <option value="Accessibility">Accessibility</option>
                                                    <option value="Learning(YI Talks)">Learning(YI Talks)</option>
                                                    <option value="Climate action">Climate action</option>
                                                    <option value="Innovation">Innovation</option>
                                                    <option value="Entrepreneurship">Entrepreneurship</option>
                                                    <option value="Branding & PR">Branding & PR</option>
                                                    <option value="Special Interest Group (S.I.G)">Special Interest Group (S.I.G)</option>
                                                    <option value="Women Engagement (YIWE)">Women Engagement (YIWE)</option>
                                                    <option value="Culture Connect">Culture Connect</option>
                                                    <option value="Yi Angel">Yi Angel</option>
                                                    <option value="Membership Engagement">Membership Engagement</option>
                                                    <!-- Add all vertical options -->
                                                  </select>
                                                  <div class="invalid-feedback" id="event_yi_vertical_error">Please provide an event Yi Vertical .</div>
                                                </div>
                                                <div class="col-md-6">
                                                  <label for="project_stakeholder" class="form-label">Project Stakeholder </label><span style="color:red;"> *</span>
                                                  <select class="form-select" id="project_stakeholder" name="project_stakeholder">
                                                    <option value="{{ event.project_stakeholder }}">{{ event.project_stakeholder }}</option>
                                                    <option value="Yuva">Yuva</option>
                                                    <option value="Thalir">Thalir</option>
                                                    <option value="Rural Initiatives">Rural Initiatives</option>
                                                    <option value="General Public">General Public</option>
                                                    <option  value="Membership">Membership</option>
                                                    {% comment %} <option value="Associate Partner">Associate Partner</option> {% endcomment %}
                                                    <option value="">None</option>
                                                    <!-- Add all stakeholder options -->
                                                  </select>
                                                  <div class="invalid-feedback" id="event_yi_stakeholder_error">Please provide an event Yi Stakeholder .</div>
                                                </div>
                                                      <div class="col-md-6">
                                                          <label for="yi_pillar" class="form-label">Yi Pillar </label><span style="color:red;"> *</span>
                                                          <select class="form-control" id="yi_pillar" name="yi_pillar">
                                                              <option value="{{ event.yi_pillar }}">{{ event.yi_pillar }}</option>
                                                              <option value="Youth Leader">Youth Leader</option>
                                                              <option value="Thought Leader">Thought Leader</option>
                                                              <option value="Nation Building">Nation Building</option>
                                                              <!-- Add all pillar options -->
                                                          </select>
                                                          <div class="invalid-feedback" id="event_yi_pillar_error">Please provide an event Yi Pillar .</div>
                                                      </div>
                                                      <div class="col-md-6">
                                                        <label for="social_link" class="form-label">Social Link</label>
                                                        <input type="url" class="form-control" id="social_link" name="social_link" value="{{ event.social_link }}">
                                                    </div>
                                                      <div class="col-md-6">
                                                          <label for="total_impact" class="form-label">Impact</label><span style="color:red;"> *</span>
                                                          <input type="text" class="form-control" id="total_impact" name="total_impact" value="{{ event.total_impact }}">
                                                          <div class="invalid-feedback" id="event_total_impact_error">Please provide an event Total Impact .</div>
                                                      </div>

                                                      <div class="col-md-6">
                                                          <label for="event_expense" class="form-label">Event Expense</label>
                                                          <input type="number" class="form-control" id="event_expense" name="event_expense" value="{{ event.event_expense }}">
                                                      </div>
                                                      <div class="col-md-6" id="sig_div">
                                                          <label for="sig_" class="form-label">Choose SIG</label>
                                                          <select class="form-control form-select" id="sig_" name="sig_">
                                                            {% if event.which_SIG  == '' or event.which_SIG == None %} 
                                                            <option   value="" >Choose SIG</option>
                                                            <option value="Active Living">Active Living</option>
                                                            <option value="Photography">Photography</option>
                                                            <option value="Trekking">Trekking</option>
                                                            <option value="Entrepreneurship">Entrepreneurship</option>
                                                            <option value="Community">Community</option>
                                                            <option value="">None</option>
                                                            {% else %}
                                                              
                                                              <option value="{{ event.which_SIG }}">{{ event.which_SIG }}</option>
                                                              <option value="Active Living">Active Living</option>
                                                              <option value="Photography">Photography</option>
                                                              <option value="Trekking">Trekking</option>
                                                              <option value="Entrepreneurship">Entrepreneurship</option>
                                                              <option value="Community">Community</option>
                                                              <option value="">None</option>{% endif %}
                                                              <!-- Add SIG options -->
                                                          </select>
                                                      </div>
                                                      <div class="col-md-6" id="school_div">
                                                          <label for="school" class="form-label">School</label>
                                                          <input type="text" id="school" class="form-control" name="school" placeholder="School" value="{{ event.school }}">
                                                      </div>

                                                      <div class="col-md-6" id="collage_div">
                                                          <label for="collage" class="form-label">College</label>
                                                          <input type="text" id="collage" class="form-control" name="collage" placeholder="College" value="{{ event.collage }}">
                                                      </div>
                                                      <div class="col-md-6" id="collage_div">
                                                        <label for="event_image" class="form-label">Event Image</label>
                                                        <input type="file" id="event_image" class="form-control" name="event_image" multiple accept=".jpeg , .png, .jpg">
                                                    </div>

                                                    <div class="col-md-6" id="collage_div">
                                                      <label for="event_description" class="form-label">Event Description</label>
                                                      <input type="textarea" class="form-control" name="event_description" id="event_description" value="{{event.event_description}}" rows="3"></input>
                                                  </div>
                                                      <div class="modal-footer">
                                                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                          <button type="submit" class="btn btn-primary">Save changes</button>
                                                      </div>
                                                  </form>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                                      {% endfor %}
                                      {% else %}
                                      <tr>
                                        <td colspan="21" class="text-center"> No Event available </td>
                                      </tr>
                                      {% endif %}
                                  </tbody>
                                 
                              </table>
                              {% comment %} <button type="submit" class='btn btn-danger'>Delete Selected</button> {% endcomment %}
                                  <!-- Pagination -->
                              </div>
                            {% comment %} </form> {% endcomment %}

                                <nav aria-label="Event table navigation">
                              <ul class="pagination justify-content-center flex-wrap">
                                <li class="page-item disabled">
                                  <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                                </li>
                                <li class="page-item active">
                                  <a class="page-link" href="#">1</a>
                                </li>
                                <li class="page-item">
                                  <a class="page-link" href="#">Next</a>
                                </li>
                              </ul>
                            </nav>
                          </div>
                        </div>
                       </div>   
                  </div>
                 
                  <div id="chartView" class="card-body" style="display: none;">
                    <div class="row">
                              <div class="col-lg-6">
                                <div class="card">
                                  <div class="card-body">
                                    <h5 class="card-title">Yi Project</h5>
                      
                                    <!-- Line Chart -->
                                    <div id="project_chart"></div>

                               
                                    <script>
                                      document.addEventListener("DOMContentLoaded", () => {
                                        new ApexCharts(document.querySelector("#project_chart"), {
                                          series: {{ project_impact_sum }},
                                          chart: {
                                            height: 350,
                                            type: 'pie',
                                            toolbar: {
                                              show: true
                                            }
                                          },
                                          labels: {{ project_chart|safe }}
                                        }).render();
                                      });
                                    </script>
                      
                              
                                    <!-- End Line Chart -->
                      
                                  </div>
                                </div>
                              </div>
                      
                              <div class="col-lg-6">
                                <div class="card">
                                  <div class="card-body">
                                    <h5 class="card-title">Yi Initiatives</h5>
                      
                                    <!-- Area Chart -->
                                    <div id="initiatives"></div>
                                    <script>
                                      document.addEventListener("DOMContentLoaded", () => {
                                        new ApexCharts(document.querySelector("#initiatives"), {
                                          series: [{
                                            data: {{ initiatives_impact_chart }}
                                          }],
                                          chart: {
                                            type: 'bar',
                                            height: 350
                                          },
                                          plotOptions: {
                                            bar: {
                                              borderRadius: 4,
                                              horizontal: false,
                                            }
                                          },
                                          dataLabels: {
                                            enabled: true
                                          },
                                          xaxis: {
                                            categories: {{ initiatives_chart|safe }}
                                          }
                                        }).render();
                                      });
                                    </script>
                      
                                    <!-- End Area Chart -->
                      
                                  </div>
                                </div>
                              </div>
                      
                              <div class="col-lg-6">
                                <div class="card">
                                  <div class="card-body">
                                    <h5 class="card-title">Yi Pillar</h5>
                      
                                    <!-- Column Chart -->
                                    <div id="yi_pillars"></div>


                                    <script>
                                      document.addEventListener("DOMContentLoaded", () => {
                                        new ApexCharts(document.querySelector("#yi_pillars"), {
                                          series: [{
                                            data: {{ yi_pillar_impact }}
                                          }],
                                          chart: {
                                            type: 'bar',
                                            height: 350
                                          },
                                          plotOptions: {
                                            bar: {
                                              borderRadius: 4,
                                              horizontal: false,
                                            }
                                          },
                                          dataLabels: {
                                            enabled: true
                                          },
                                          xaxis: {
                                            categories: {{ yi_pillar_chart|safe }}
                                          }
                                        }).render();
                                      });
                                    </script>
                      
                                  
                                    <!-- End Column Chart -->
                      
                                  </div>
                                </div>
                              </div>
                      
                              <div class="col-lg-6">
                                <div class="card">
                                  <div class="card-body">
                                    <h5 class="card-title">Yi Stakeholder</h5>
                      
                                    <!-- Bar Chart -->
                                    <div id="pieChart"></div>

                                    <script>
                                      document.addEventListener("DOMContentLoaded", () => {
                                        new ApexCharts(document.querySelector("#pieChart"), {
                                          series: {{ yi_stakeholder_impact }},
                                          chart: {
                                            height: 350,
                                            type: 'pie',
                                            toolbar: {
                                              show: true
                                            }
                                          },
                                          labels: {{ yi_stakeholder_chart|safe }}
                                        }).render();
                                      });
                                    </script>
                                
                                    <!-- End Bar Chart -->
                      
                                  </div>
                                </div>
                              </div>
                      
                              {% comment %} <div class="col-lg-6">
                                <div class="card">
                                  <div class="card-body">
                                    <h5 class="card-title">Pie Chart</h5>
                      
                                    <!-- Pie Chart -->
                                    <div id="pieChart"></div>
                      
                                    <!-- End Pie Chart -->
                      
                                  </div>
                                </div>
                              </div> {% endcomment %}
{% comment %}                       
                              <div class="col-lg-6">
                                <div class="card">
                                  <div class="card-body">
                                    <h5 class="card-title">Donut Chart</h5>
                      
                                    <!-- Donut Chart -->
                                    <div id="donutChart"></div>
                      
                            
                                    <!-- End Donut Chart -->
                      
                                  </div>
                                </div>
                              </div> {% endcomment %}
{% comment %}                       
                              <div class="col-lg-6">
                                <div class="card">
                                  <div class="card-body">
                                    <h5 class="card-title">Radar Chart</h5>
                      
                                    <!-- Radar Chart -->
                                    <div id="radarChart"></div>
                      
                              
                                    <!-- End Radar Chart -->
                      
                                  </div>
                                </div>
                              </div> {% endcomment %}
                      
                              {% comment %} <div class="col-lg-6">
                                <div class="card">
                                  <div class="card-body">
                                    <h5 class="card-title">Polar Area Chart</h5>
                      
                                    <!-- Polar Area Chart -->
                                    <div id="polarAreaChart"></div>
                      
                                    
                                    <!-- End Polar Area Chart -->
                      
                                  </div>
                                </div>
                              </div> {% endcomment %}
                      
                              {% comment %} <div class="col-lg-6">
                                <div class="card">
                                  <div class="card-body">
                                    <h5 class="card-title">Radial Bar Chart</h5>
                      
                                    <!-- Radial Bar Chart -->
                                    <div id="radialBarChart"></div>
                      
                                
                                    <!-- End Radial Bar Chart -->
                      
                                  </div>
                                </div>
                              </div> {% endcomment %}
                      
                              {% comment %} <div class="col-lg-6">
                                <div class="card">
                                  <div class="card-body">
                                    <h5 class="card-title">Bubble Chart</h5>
                      
                                    <!-- Bubble Chart -->
                                    <div id="bubbleChart"></div>
                      
                                
                                    <!-- End Bubble Chart -->
                      
                                  </div>
                                </div>
                              </div> {% endcomment %}
                      </div>
                      
                  </div>
                            
                 
                
                  
                  </div>


                  
      </section>
  </main>
<!-- End #main -->
  {% endblock bodyblock %} 
  


  {% block script %}
  

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tableViewBtn = document.getElementById('tableViewBtn');
    const chartViewBtn = document.getElementById('chartViewBtn');
    const tableView = document.getElementById('tableView');
    const chartView = document.getElementById('chartView');

    // Toggle view function
    function toggleView(showTable) {
        if (showTable) {
            tableView.style.display = 'block';
            chartView.style.display = 'none';
            tableViewBtn.classList.remove('btn-outline-primary');
            tableViewBtn.classList.add('btn-primary');
            chartViewBtn.classList.remove('btn-primary');
            chartViewBtn.classList.add('btn-outline-primary');
        } else {
            tableView.style.display = 'none';
            chartView.style.display = 'block';
            chartViewBtn.classList.remove('btn-outline-primary');
            chartViewBtn.classList.add('btn-primary');
            tableViewBtn.classList.remove('btn-primary');
            tableViewBtn.classList.add('btn-outline-primary');
        }
    }

    // Event listeners for view toggle buttons
    tableViewBtn.addEventListener('click', () => toggleView(true));
    chartViewBtn.addEventListener('click', () => toggleView(false));
});
</script>

{% comment %} 
<script>
  var chrt = document.getElementById("chartId").getContext("2d");
  var chartId = new Chart(chrt, {
    type: 'pie',
    data: {
      labels: {{ project_chart|safe }},
      datasets: [{
        label: "Total Impact",
        data: {{project_impact_sum}},
        backgroundColor: ['blue', 'aqua', 'lightblue', 'lightgreen', 'gold', ],
        hoverOffset: 15
      }],
    },
    options: {
      
      responsive: false,
      plugins: {
        datalabels: {
          color: 'rgb(0, 0, 0)', // or '#000' depending on contrast
          anchor: 'center',
          align: 'end',
          
          offset: -10,
          font: {
           family:'self',
            size: 18
          },
          formatter: (value) => value // You can customize this as needed
        },
        legend: {
          position: 'right', // Move the legend to the right side
        },
        tooltip: {
          enabled: true // Optionally, disable the tooltips if you prefer the labels to be visible without hovering
        }
      },
    },
    plugins: [ChartDataLabels]
  });
</script>

 {% endcomment %}

{% comment %} 
<script>
  var chrt = document.getElementById("pillar_pie").getContext("2d");
  var chartId = new Chart(chrt, {
    type: 'doughnut',
    data: {
      labels: {{ yi_pillar_chart|safe }},
      datasets: [{
        label: "Total Impact",
        data: {{yi_pillar_impact}},
        backgroundColor: ['blue', 'aqua', 'lightblue', 'lightgreen', 'gold', ],
        hoverOffset: 15
      }],
    },
    options: {
      
      responsive: false,
      plugins: {
        datalabels: {
          color: 'rgb(0, 0, 0)', // or '#000' depending on contrast
          anchor: 'center',
          align: 'end',
          
          offset: -10,
          font: {
           family:'self',
            size: 18
          },
          formatter: (value) => value // You can customize this as needed
        },
        legend: {
          position: 'right', // Move the legend to the right side
        },
        tooltip: {
          enabled: true // Optionally, disable the tooltips if you prefer the labels to be visible without hovering
        }
      },
    },
    plugins: [ChartDataLabels]
  });
</script> {% endcomment %}




<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Get all the event-handle elements in the table
    const eventHandles = document.querySelectorAll('.event-handle');
    
    // Loop through each event-handle element
    eventHandles.forEach(function (eventHandleElement) {
        // Get the event_handle content
        const eventHandle = eventHandleElement.innerText;
        
        // Split the data by commas
        const names = eventHandle.split(',');
        
        // Create a select element
        const select = document.createElement('select');
        select.className = 'event-handle form-select fomr-control border'; // Add a class for styling if needed
        
        // Create a default option
        const defaultOption = document.createElement('link');
        defaultOption.text = 'See Member';
        defaultOption.value = '';
        select.appendChild(defaultOption);
        
        // Loop through each name and create an option for it
        names.forEach(function (name) {
            // Trim any extra spaces from the name
            const trimmedName = name.trim();
            
            // Create the option element
            const option = document.createElement('option');
            option.value = trimmedName;
            option.text = trimmedName;
            
            // Append the option to the select
            select.appendChild(option);
        });
        
        // Clear the original content in the <td>
        eventHandleElement.innerHTML = '';
        
        // Append the new formatted select menu
        eventHandleElement.appendChild(select);
    });
});
</script>

{% comment %} 

<script>
  var ctx = document.getElementById('barChart').getContext('2d');
  var eventChart = new Chart(ctx, {
      type: 'bar',  // Specify the chart type
      data: {
          labels: {{ yi_pillar_chart|safe }},  // Event names (project_vertical) from Django context
          datasets: [{
            type: 'bar',
            label: 'Yi Pillar Wise Count',
            backgroundColor: 'rgb(25, 255, 236)',  // Bar color
            borderColor: 'rgb(0, 0, 0)',
            borderWidth: 1,
            hoverOffset: 15
            data: {{  yi_pillar_count}}
          
        },{
              label: 'Yi Pillar Wise Impact',
              data: {{ yi_pillar_impact }},  // Impact values (total_impact) from Django context
              backgroundColor: 'rgb(45, 0, 248)',  // Bar color
              borderColor: 'rgb(0, 0, 0)',
              borderWidth: 1,
              hoverOffset: 15
          datalabels: {
                align: 'start',
                anchor: 'end',
                offset:-20
              }
          }]
      },
      options: {
        plugins: {
          datalabels: {
            color: 'rgb(0, 0, 0)', // or '#000' depending on contrast
            anchor: 'end',
            align: 'end',
            
            offset: -10,
            font: {
             family:'self',
              size: 18
            },
            formatter: (value) => value // You can customize this as needed
          }
        },
        animation: {
          onComplete: () => {
            delayed = true;
          },
          delay: (context) => {
            let delay = 0;
            if (context.type === 'data' && context.mode === 'default' && !delayed) {
              delay = context.dataIndex * 300 + context.datasetIndex * 100;
            }
            return delay;
          },
        },

          responsive: true,
          scales: {
      
              x: {
                grid: {
                  display: false
                }
              },
              y: {
               
                grid: {
                  display: true
                }
                
              }
          }
      },
      plugins: [ChartDataLabels]
  });
</script>
 {% endcomment %}


{% comment %} 

<script>
  var ctx = document.getElementById('month').getContext('2d');
  var eventChart = new Chart(ctx, {
      type: 'bar',  // Specify the chart type
      data: {
          labels: {{month_wise_impact|safe}},  // Event names (project_vertical) from Django context
          datasets: [{
              label: 'Yi Pillar Wise Impact',
              data: {{ date_chart_impact|safe }},  // Impact values (total_impact) from Django context
              backgroundColor: 'rgb(45, 0, 248)',  // Bar color
              borderColor: 'rgb(0, 0, 0)',
              borderWidth: 1,
          datalabels: {
                align: 'start',
                anchor: 'end',
                offset:-20
              }
          }]
      },
      options: {
        plugins: {
          datalabels: {
            color: '#000',
            display: function(context) {
              return context.dataset.data[context.dataIndex];
            }
          }
        } ,

          responsive: true,
          scales: {
        

              x: {
                grid: {
                  display: false
                }
              },
              y: {
               
                grid: {
                  display: true
                }
                
              }
          }
      }
  });
</script> {% endcomment %}



{% comment %} <script>
  var ctx = document.getElementById('initiatives').getContext('2d');
  var eventChart = new Chart(ctx, {
      type: 'bar',  // Specify the chart type
      data: {
          labels: {{ initiatives_chart|safe }},  // Event names (project_vertical) from Django context
          datasets: [
            
          {
            type: 'bar',
            label: 'Initiatives Event',
            backgroundColor: 'rgb(25, 255, 236)',  // Bar color
            borderColor: 'rgb(0, 0, 0)',
            borderWidth: 1,
            hoverOffset: 15,
            data: {{  initiatives_count_chart }}
          
        },
        {
              label: 'Initiatives Impact',
              data: {{ initiatives_impact_chart }},  // Impact values (total_impact) from Django context
              backgroundColor: 'rgb(45, 0, 248)',  // Bar color
              borderColor: 'rgb(0, 0, 0)',
              hoverOffset: 15,
              borderWidth: 1,
          
          }]
      },
      options: {
        plugins: {
          datalabels: {
            color: 'rgb(0, 0, 0)', // or '#000' depending on contrast
            anchor: 'end',
            align: 'end',
            
            offset: -10,
            font: {
             family:'self',
              size: 18
            },
            formatter: (value) => value // You can customize this as needed
          }
        },  animation: {
          onComplete: () => {
            delayed = true;
          },
          delay: (context) => {
            let delay = 0;
            if (context.type === 'data' && context.mode === 'default' && !delayed) {
              delay = context.dataIndex * 300 + context.datasetIndex * 100;
            }
            return delay;
          },
        },


          responsive: true,
          scales: {
        

              x: {
                grid: {
                  display: false
                }
              },
              y: {
               
                grid: {
                  display: true
                }
                
              }
          }
      },
      plugins: [ChartDataLabels]
  });
</script> {% endcomment %}
{% comment %} 
<script>
  var ctx = document.getElementById('vertical_chart').getContext('2d');
  var eventChart = new Chart(ctx, {
      
      type: 'bar',  // Specify the chart type
      data: {
          labels: {{ vertical_chart|safe }},  // Event names (project_vertical) from Django context
          datasets: [
            
            {
                type: 'bar',
                label: 'Total Event',
                backgroundColor: 'rgb(25, 255, 236)',  // Bar color
                borderColor: 'rgb(0, 0, 0)',
                borderWidth: 1,
                data: {{  vertical_wise_impact }}
              
            },
            {
                type: 'bar',
                label: 'Total Impact',
                backgroundColor: 'rgb(45, 0, 248)',
                data: {{impact_chart}}
            }
        ]
      },
      options: {

          responsive: true,
          scales: {
        

              x: {
                
                grid: {
                  display: false
                }
              },
              y: {
                
                grid: {
                  display: true
                }
                
              }
          }
      }
  });
</script>
 {% endcomment %}


{% comment %} 
<script>
  var ctx = document.getElementById('stakeholder_event').getContext('2d');
  var eventChart = new Chart(ctx, {
      type: 'bar',  // Specify the chart type
      data: {
          labels: {{ yi_stakeholder_chart|safe }},  // Event names (project_vertical) from Django context
          datasets: [
         
              {
                type: 'bar',
                label: 'Yi Stakeholder Event',
                backgroundColor: 'rgb(25, 255, 236)',  // Bar color
                borderColor: 'rgb(0, 0, 0)',
                borderWidth: 1,
                data: {{ yi_stakeholder_count|safe }}
              
            },{
              label: 'Yi Stakeholder Impact',
              data: {{ yi_stakeholder_impact }},  // Impact values (total_impact) from Django context
              backgroundColor: 'rgb(45, 0, 248)',  // Bar color
              borderColor: 'rgb(0, 0, 0)',
              borderWidth: 1,
              datalabels: {
                align: 'start',
                anchor: 'end',
                offset:-20
              }
          }]
      },
      options: {
        plugins: {
          datalabels: {
            color: 'rgb(0, 0, 0)', // or '#000' depending on contrast
            anchor: 'end',
            align: 'start',
            
            offset: -10,
            font: {
             family:'self',
              size: 18
            },
            formatter: (value) => value // You can customize this as needed
          }
        },
        animation: {
          onComplete: () => {
            delayed = true;
          },
          delay: (context) => {
            let delay = 0;
            if (context.type === 'data' && context.mode === 'default' && !delayed) {
              delay = context.dataIndex * 300 + context.datasetIndex * 100;
            }
            return delay;
          },
        },
        scales: {
          x: {
            grid: {
              display: false
            }
          },
          y: {
           
            grid: {
              display: true
            }
            
          }
        }
      },
      plugins: [ChartDataLabels]
    });

</script> {% endcomment %}



{% comment %} 
<script>
  let delayed;

  const ctx1 = document.getElementById('lineBarChart').getContext('2d');
  new Chart(ctx1, {
    type: 'bar',
    data: {
      labels: {{ project_chart|safe }},
      datasets: [
        {
          type: 'bar',
          label: 'Total Event',
          backgroundColor: 'rgb(0, 183, 255)',  // Bar color
          borderColor: 'rgb(0, 0, 0)',
          borderWidth: 1,
          data: {{  project_count_chart }}
        
      },
        {
          type: 'bar',
          label: 'Total Impact',
          backgroundColor: 'rgb(45, 0, 248)',
          data: {{ project_impact_sum }},
        }
      ]
    },
    options: {
      plugins: {
        datalabels: {
          color: 'rgb(0, 0, 0)', // or '#000' depending on contrast
          anchor: 'end',
          align: 'end',
          
          offset: -10,
          font: {
           family:'self',
            size: 18
          },
          formatter: (value) => value // You can customize this as needed
        }
      },
      animation: {
        onComplete: () => {
          delayed = true;
        },
        delay: (context) => {
          let delay = 0;
          if (context.type === 'data' && context.mode === 'default' && !delayed) {
            delay = context.dataIndex * 300 + context.datasetIndex * 100;
          }
          return delay;
        },
      },
      scales: {
        x: {
          grid: {
            display: false
          }
        },
        y: {
          grid: {
            display: true
          }
        }
      }
    },
    plugins: [ChartDataLabels]
  });
</script>
 {% endcomment %}




  <script src="{% static 'assets/vendor/echarts/echarts.min.js' %}"></script>
  <script src="{% static 'js/dashboard.js' %}"></script>

  
  {% endblock script %}




  

  {% comment %} event_list = Event_Data.objects.all()
  # Handle search filtering
  search = request.GET.get('search')
  if search and search != 'all':
      event_list = event_list.filter(your_name__icontains=search)  # Filter based on 'search'

  # Apply demo filter if provided
  demo = request.GET.get('demo')
  if demo and demo != 'all':
      event_list = event_list.filter(project_vertical__icontains=demo) {% endcomment %}

